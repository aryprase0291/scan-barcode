<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scan App</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>

    <div class="app-header">
        <h1>Scanner Inventory</h1>
    </div>

    <div class="scanner-wrapper">
        <div id="reader"></div>
    </div>

    <div class="status-card">
        <div class="status-title">STATUS</div>
        <div id="result" class="status-text">Siap Scan...</div>
    </div>

    <script>
        // --- CONFIG ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwCJLPFpjknY1UUKje86ZBhgKdexVSXwUs1tvV-NEhorxeqTE2Y3X3uJD5Lfa4u4B5W_w/exec";

        function onScanSuccess(decodedText, decodedResult) {
            html5QrcodeScanner.clear();
            
            // Update UI: Loading
            const resultEl = document.getElementById('result');
            resultEl.innerText = `Mengirim: ${decodedText}...`;
            resultEl.className = "status-text loading-pulse";

            // Kirim Data
            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify({ barcode: decodedText })
            })
            .then(() => {
                // Update UI: Sukses
                resultEl.innerText = `✅ SUKSES: ${decodedText}`;
                resultEl.classList.remove("loading-pulse");
                resultEl.classList.add("status-success");
                
                if (window.navigator && window.navigator.vibrate) {
                    window.navigator.vibrate(200); 
                }

                // Restart Scanner
                setTimeout(() => {
                    location.reload();
                }, 1500);
            })
            .catch(error => {
                resultEl.innerText = "❌ Gagal Mengirim";
                resultEl.classList.add("status-error");
            });
        }

        function onScanFailure(error) {}

        const formatsToSupport = [
            Html5QrcodeSupportedFormats.PDF_417,
            Html5QrcodeSupportedFormats.QR_CODE,
            Html5QrcodeSupportedFormats.CODE_128,
            Html5QrcodeSupportedFormats.EAN_13,
            Html5QrcodeSupportedFormats.UPC_A, 
            Html5QrcodeSupportedFormats.CODE_39
        ];

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", 
            { 
                fps: 25, 
                qrbox: {width: 250, height: 200},
                formatsToSupport: formatsToSupport,
                experimentalFeatures: { useBarCodeDetectorIfSupported: true }
            },
            false
        );
        
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    </script>

</body>
</html>