<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AHM System v6</title>
    
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="navbar">
        <div class="brand">
            <span style="color:var(--primary)">AHM</span> SYSTEM
        </div>
        <div class="version-badge">PRO v6.2</div>
    </div>

    <div class="menu-wrapper">
        <div class="menu-container">
            <button class="menu-btn active" onclick="setMode('scan')">Sparepart</button>
            <button class="menu-btn" onclick="setMode('unit')">Unit</button>
            <button class="menu-btn" onclick="setMode('master')">Input</button>
            <button class="menu-btn" onclick="setMode('view')">Stok</button>
            <button class="menu-btn" onclick="setMode('laporan')">Laporan</button>
        </div>
    </div>

    <div class="main-content">

        <div id="view-scan" class="view-section">
            <div class="tx-switch-container">
                <input type="radio" id="mode-out" name="tx_mode" value="OUT" checked>
                <label for="mode-out" class="switch-btn btn-out">KELUAR (Pakai)</label>
                
                <input type="radio" id="mode-in" name="tx_mode" value="IN">
                <label for="mode-in" class="switch-btn btn-in">MASUK (Restock)</label>
            </div>

            <div id="scan-title" class="section-title">ARAHKAN KAMERA</div>
            
            <div class="scanner-frame">
                <div id="reader"></div>
            </div>

            <div class="manual-input-wrapper">
                <div class="separator-text">â€” ATAU KETIK KODE â€”</div>
                <div class="input-group-row">
                    <input type="text" id="manual-barcode" class="input-modern" placeholder="Ketik kode part..." autocomplete="off">
                    <button class="btn-icon-only" onclick="prosesManual()">âž”</button>
                </div>
            </div>

            <div class="mutation-report-card">
                <div class="card-header-small">DOWNLOAD MUTASI (Masuk/Keluar)</div>
                <div class="button-row">
                    <button class="btn-soft btn-green" onclick="downloadMutasi('EXCEL')">ðŸ“Š Excel</button>
                    <button class="btn-soft btn-red" onclick="downloadMutasi('PDF')">ðŸ“„ PDF</button>
                </div>
            </div>

            <div id="overlay-success" class="scan-overlay">
                <div class="check-circle">âœ“</div>
                <div class="success-text">BERHASIL!</div>
            </div>
        </div>

        <div id="view-form" class="view-section" style="display:none;">
            <div class="card-modern">
                <div id="form-title" class="card-title">INPUT PART BARU</div>
                <input type="hidden" id="edit_mode" value="false">

                <div class="toggle-row">
                    <span>Gunakan Scanner</span>
                    <label class="switch">
                        <input type="checkbox" id="chk-camera" checked onchange="toggleCameraInput()">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div id="input-camera-wrapper" class="mini-scanner-box">
                    <div id="reader-mini"></div>
                    <div class="scan-frame-custom"></div>
                    <div class="mini-scanner-hint">Scan barcode barang</div>
                </div>

                <div class="form-grid">
                    <div class="input-group">
                        <label>Barcode</label>
                        <input type="text" id="inp_barcode" class="input-modern" placeholder="Scan / Ketik...">
                    </div>
                    
                    <div class="input-group">
                        <label>Nama Barang</label>
                        <input type="text" id="inp_nama" class="input-modern" placeholder="Contoh: Oli MPX2">
                    </div>

                    <div class="input-group">
                        <label>Harga Jual ($)</label>
                        <input type="number" id="inp_harga" class="input-modern" placeholder="0">
                    </div>

                    <div class="input-group">
                        <label>Satuan</label>
                        <div class="select-wrapper">
                            <select id="inp_satuan" class="input-modern">
                                <option value="PCS">PCS</option>
                                <option value="SET">SET</option>
                                <option value="BOTOL">BOTOL</option>
                                <option value="UNIT">UNIT</option>
                                <option value="LITER">LITER</option>
                                <option value="DUS">DUS</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Keterangan</label>
                        <input type="text" id="inp_ket" class="input-modern" placeholder="Opsional...">
                    </div>
                </div>

                <button id="btn-submit" class="btn-block-primary" onclick="simpanData()">SIMPAN DATA</button>
            </div>
        </div>

        <div id="view-list" class="view-section" style="display:none;">
            <div class="search-bar-sticky">
                <input type="text" id="search-input" class="search-input-lg" placeholder="ðŸ” Cari Barang..." onkeyup="filterList()">
            </div>
            
            <div class="download-chips">
                <button class="chip-btn excel" onclick="downloadExcel()">ðŸ“¥ Unduh Excel</button>
                <button class="chip-btn pdf" onclick="downloadPDF()">ðŸ“„ Unduh PDF</button>
            </div>

            <div id="list-loader" class="loader">Loading...</div>
            <div id="list-content" class="list-wrapper"></div>
        </div>

        <div id="view-laporan" class="view-section" style="display:none;">
    
    <div class="card-modern">
        <div class="card-title">LAPORAN UNIT & INVENTORY</div>
        <button class="btn-block-primary" onclick="downloadExcelUnit()" style="background: #10B981;">
            ðŸ“Š UNDUH EXCEL (AUTO-FILTER & SORT)
        </button>
    </div>

    <div class="date-range-box">
        <div class="date-field">
            <label>Dari</label>
            <input type="date" id="date-start" class="input-modern">
        </div>
        <div class="date-field">
            <label>Sampai</label>
            <input type="date" id="date-end" class="input-modern">
        </div>
    </div>
    
    <button class="btn-block-primary" onclick="tarikLaporan()">TARIK DATA</button>
    
    <div id="report-result" style="display:none; margin-top:20px;">
        <div class="summary-box">
            <div class="summary-label">TOTAL UNIT</div>
            <div id="total-unit" class="summary-val">0</div>
        </div>
        <table class="table-modern">
            <thead>
                <tr>
                    <th>Tipe / Barcode</th>
                    <th style="text-align:right;">Jml</th>
                </tr>
            </thead>
            <tbody id="report-body"></tbody>
        </table>
    </div>

    </div> 
    <div id="modal-qty" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-top">
            <span id="modal-title">KONFIRMASI</span>
            <button onclick="closeModal()" class="btn-close">&times;</button>
        </div>

        <div class="modal-center">
            <input type="text" id="tx-barcode" class="input-readonly-center" readonly style="font-weight: bold; color: var(--primary);">
            
            <div id="area-info-unit" style="display:none; background: #f0f0f0; padding: 10px; border-radius: 12px; margin-bottom: 15px; text-align: left; font-size: 13px;">
                <div style="margin-bottom:4px;"><strong>Tipe:</strong> <span id="info-tipe">-</span></div>
                <div><strong>Warna:</strong> <span id="info-warna">-</span></div>
            </div>

            <div class="qty-control" id="qty-container">
                <button class="btn-circle" onclick="adjustQty(-1)">âˆ’</button>
                <input type="number" id="tx-qty" value="1">
                <button class="btn-circle" onclick="adjustQty(1)">+</button>
            </div>
            
            <input type="text" id="tx-ket" class="input-modern" placeholder="Keterangan..." style="text-align:center;">
        </div>

        <button class="btn-block-primary" onclick="kirimTransaksi()">KIRIM DATA</button>
    </div>
</div>

    <div id="modal-detail" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-top">
                <span style="font-weight:800; color:var(--text-gray);">DETAIL BARANG</span>
                <button onclick="closeDetailModal()" class="btn-close">&times;</button>
            </div>
            
            <div class="modal-center" style="text-align:left;">
                <div class="detail-group">
                    <label>Barcode / Kode Part</label>
                    <div id="det-barcode" class="detail-value copyable" onclick="copyText(this)">...</div>
                </div>

                <div class="detail-group">
                    <label>Nama Barang</label>
                    <div id="det-nama" class="detail-value highlight-text">...</div>
                </div>

                <div class="detail-row">
                    <div class="detail-group">
                        <label>Harga Jual</label>
                        <div id="det-harga" class="detail-value">...</div>
                    </div>
                     <div class="detail-group">
                        <label>Stok</label>
                        <div id="det-stok" class="detail-value">...</div>
                    </div>
                </div>

                <div class="detail-group">
                    <label>Keterangan / Deskripsi Lengkap</label>
                    <div id="det-ket" class="detail-value detail-desc">...</div>
                </div>
            </div>

            <button class="btn-block-primary" onclick="closeDetailModal()">TUTUP</button>
        </div>
    </div>

    <div id="toast">Notifikasi</div>

    <script src="script.js"></script>
</body>
</html>